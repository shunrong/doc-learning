# 文档协同技术学习路线图

## 整体路线

```
第一阶段：基础认知（1-2周）
├── Phase 1: 富文本编辑器基础
│   ├── ContentEditable API
│   ├── Selection/Range API
│   └── Delta 数据结构
└── Phase 2: 文档数据结构与操作
    ├── Operation 模型
    ├── 扁平 vs 树形结构
    └── 操作的组合与转换

第二阶段：单机功能（1-1.5周）
└── Phase 3: 历史记录与撤销重做
    ├── Undo/Redo 栈
    ├── 历史快照策略
    └── 本地持久化

第三阶段：实时通信（0.5-1周）
└── Phase 4: 实时通信基础设施
    ├── WebSocket 架构
    ├── 房间管理
    └── 协作者状态同步

第四阶段：协同核心（2-3周）⭐️
├── Phase 5: OT 协同引擎
│   ├── Transform 函数
│   ├── 中心化架构
│   └── 冲突解决
└── Phase 6: CRDT 协同方案
    ├── Yjs 使用
    ├── 离线编辑
    └── P2P 协同
```

## 学习路径对比

### 快速路径（3周）
适合：面试准备、快速上手

```
Phase 1 (1周) → Phase 4 (0.5周) → Phase 6 (1.5周)
```

**跳过的内容：**
- Phase 2: 数据结构深入（可以后补）
- Phase 3: 历史记录（非核心）
- Phase 5: OT 算法（用 CRDT 替代）

**学习重点：**
- 编辑器基本原理
- 实时通信架构
- Yjs 的使用

### 完整路径（6-7周）
适合：深度学习、技术积累

```
Phase 1 → Phase 2 → Phase 3 → Phase 4 → Phase 5 → Phase 6
```

**优势：**
- 完整的知识体系
- 理解底层原理
- 能够自己实现协同引擎

**挑战：**
- 时间投入大
- Phase 5 难度高

### 平衡路径（4-5周）⭐️ 推荐
适合：大多数学习者

```
Phase 1 (1周) → Phase 2 (1周) → Phase 4 (0.5周) → Phase 6 (1周) → Phase 5 (1.5周)
```

**优势：**
- 先掌握实用技能（Yjs）
- 再理解底层原理（OT）
- 避免被 OT 算法劝退
- 知识体系相对完整

## 各阶段详细规划

### Phase 1: 富文本编辑器基础（1周）

**Day 1-2: 理论学习**
- [ ] 阅读 ContentEditable API 文档
- [ ] 运行 Demo 1、2，理解浏览器差异
- [ ] 思考：为什么需要编辑器框架？

**Day 3-4: Selection API**
- [ ] 阅读 Selection/Range 文档
- [ ] 运行 Demo 3，实验各种选区操作
- [ ] 实现：保存/恢复选区功能

**Day 5-6: Delta 数据结构**
- [ ] 阅读 Delta 格式文档
- [ ] 运行 Demo 4，理解三种操作
- [ ] 实现：简化版的 Delta apply 函数

**Day 7: 总结提升**
- [ ] 整理学习笔记
- [ ] 实现一个最小化编辑器
- [ ] 思考：协同编辑需要什么？

**验收标准：**
- ✅ 能解释 ContentEditable 的问题
- ✅ 能操作 Selection 和 Range
- ✅ 能手写 Delta 描述文档变更

---

### Phase 2: 文档数据结构与操作（1.5周）

**Day 1-3: Operation 模型**
- [ ] 理解 Operation 的设计原理
- [ ] 实现 apply、invert、compose
- [ ] 编写测试用例

**Day 4-6: 数据模型对比**
- [ ] 实现扁平化模型（Delta 风格）
- [ ] 实现树形模型（Slate 风格）
- [ ] 对比两者的优劣

**Day 7-10: 操作压缩**
- [ ] 实现 Operation 合并
- [ ] 优化内存占用
- [ ] 性能测试

**验收标准：**
- ✅ 完成 Operation 的核心方法
- ✅ 理解扁平 vs 树形的适用场景
- ✅ 能手动推演操作变换

---

### Phase 3: 历史记录与撤销重做（1周）

**Day 1-3: 撤销重做栈**
- [ ] 实现 UndoManager
- [ ] 处理边界情况
- [ ] 集成到编辑器

**Day 4-5: 历史快照**
- [ ] 实现快照策略
- [ ] 版本历史列表
- [ ] 时间旅行功能

**Day 6-7: 本地持久化**
- [ ] IndexedDB 存储
- [ ] 自动保存
- [ ] 离线编辑

**验收标准：**
- ✅ 完整的撤销重做功能
- ✅ 历史版本回溯
- ✅ 离线编辑支持

---

### Phase 4: 实时通信基础设施（0.5-1周）

**Day 1-2: WebSocket 服务器**
- [ ] 搭建 Node.js 服务器
- [ ] 实现房间管理
- [ ] 心跳和重连机制

**Day 3-4: 客户端集成**
- [ ] WebSocket 客户端
- [ ] 消息队列和可靠传输
- [ ] 用户在线状态

**Day 5: 远程光标**
- [ ] 光标位置同步
- [ ] 远程光标渲染
- [ ] Awareness 协议

**验收标准：**
- ✅ 稳定的 WebSocket 连接
- ✅ 多人在线状态同步
- ✅ 远程光标显示

**优势：** 可以复用你的音视频经验！

---

### Phase 5: OT 协同引擎（2周）⭐️ 最难

**Day 1-3: OT 算法理论**
- [ ] 理解 OT 的核心思想
- [ ] 学习 Transform 函数
- [ ] 理解 TP1/TP2 性质

**Day 4-7: 实现 Transform**
- [ ] 实现简单的双向转换
- [ ] 处理各种操作组合
- [ ] 编写大量测试用例

**Day 8-10: 服务端 OT 引擎**
- [ ] 实现 OT 服务器
- [ ] 版本管理
- [ ] 操作历史

**Day 11-14: 客户端集成**
- [ ] 乐观更新
- [ ] 操作确认和转换
- [ ] 处理并发冲突

**验收标准：**
- ✅ 完成基本的 OT 转换
- ✅ 两个客户端能协同编辑
- ✅ 理解 OT 的局限性

**学习资源：**
- OT 算法论文
- operational-transformation.github.io
- Google Wave OT 实现

---

### Phase 6: CRDT 协同方案（1周）

**Day 1-2: CRDT 理论**
- [ ] 理解 CRDT 的核心思想
- [ ] 学习 Yjs 的 YATA 算法
- [ ] 对比 OT vs CRDT

**Day 3-4: Yjs 集成**
- [ ] 集成 Yjs 和 Tiptap
- [ ] 实现协同编辑
- [ ] 远程光标和选区

**Day 5-6: 高级特性**
- [ ] 离线编辑（IndexedDB Provider）
- [ ] P2P 协同（y-webrtc）
- [ ] 历史版本管理

**Day 7: 生产优化**
- [ ] 性能优化
- [ ] 错误处理
- [ ] 监控和日志

**验收标准：**
- ✅ 使用 Yjs 完成协同编辑器
- ✅ 支持离线编辑
- ✅ 理解 CRDT 的优势和代价

---

## 学习方法建议

### 1. 理论先行
每个阶段先阅读理论文档，建立概念框架。

### 2. 动手实践
不要只看不做，一定要运行 Demo，修改代码。

### 3. 写测试
特别是算法部分，写测试能帮助理解。

### 4. 做笔记
整理自己的理解，用自己的话解释概念。

### 5. 对比学习
对比不同方案（OT vs CRDT、Quill vs Slate），理解权衡。

### 6. 循序渐进
不要跳跃，每个阶段都要扎实掌握。

## 学习资源汇总

### 基础知识
- MDN Web Docs
- JavaScript.info

### 编辑器框架
- Quill 官方文档
- Slate 官方文档
- ProseMirror 指南
- Tiptap 文档

### 协同编辑
- Yjs 官方文档
- OT 论文和教程
- CRDT 综述

### 实战案例
- 飞书文档技术分享
- 语雀编辑器架构
- Notion 技术栈

## 时间规划建议

### 全职学习（每天6-8小时）
- **快速路径：** 3周
- **平衡路径：** 4-5周
- **完整路径：** 6-7周

### 业余学习（每天2-3小时）
- **快速路径：** 6-8周
- **平衡路径：** 10-12周
- **完整路径：** 12-16周

### 周末学习（每周10-12小时）
- **快速路径：** 8-10周
- **平衡路径：** 12-16周
- **完整路径：** 16-20周

## 如何检验学习效果？

### Phase 1-2 后
能够回答：
- 为什么需要富文本编辑器框架？
- Delta 和树形结构各有什么优势？
- 如何实现一个最小化的编辑器？

### Phase 3-4 后
能够实现：
- 带撤销重做的编辑器
- 多人在线状态显示
- 远程光标同步

### Phase 5-6 后
能够解释：
- OT 和 CRDT 的区别
- 为什么 Google Docs 用 OT？
- 为什么 Notion 用 CRDT？
- 如何选择协同方案？

### 完成全部后
能够做到：
- 从零实现一个协同编辑器
- 理解主流产品的技术选型
- 在面试中深入讨论协同编辑

## 进阶方向

完成基础学习后，可以继续探索：

1. **复杂场景**
   - 表格协同编辑
   - 实时评论系统
   - 权限控制

2. **性能优化**
   - 百万字符大文档
   - 虚拟滚动
   - Canvas 渲染

3. **移动端**
   - 触摸交互
   - 虚拟键盘
   - 手势操作

4. **开源贡献**
   - 参与 Yjs、Slate 等项目
   - 编写插件
   - 分享经验

## 常见问题

### Q: 需要什么基础？
- JavaScript ES6+
- React 基础（Phase 3 后）
- Node.js 基础（Phase 4 后）
- 算法基础（Phase 5）

### Q: 哪个阶段最难？
Phase 5 的 OT 算法最难，需要数学推导和大量测试。

### Q: 能跳过某些阶段吗？
可以，但建议至少完成 Phase 1、4、6。

### Q: 学完能做什么？
- 开发协同编辑功能
- 理解主流产品架构
- 面试加分项
- 开源贡献

### Q: 如何保持动力？
- 设定小目标
- 每周复盘
- 和他人交流
- 实现感兴趣的功能

---

**开始学习：** 从 Phase 1 开始，祝你成功！🚀

