# 快速开始指南

> 5 分钟体验协同编辑的魔力 ✨

## 🚀 最快启动方式

### 方式一：从项目根目录

```bash
# 在 doc-learning 根目录

# 启动服务器
pnpm server:phase6

# 新终端：启动前端
pnpm client:phase6
```

### 方式二：从 Phase 6 目录

```bash
cd packages/05-collaborative-editor-yjs

# 启动服务器
cd server && pnpm dev

# 新终端：启动前端
cd client && pnpm dev
```

---

## 🎮 体验功能

### 1. 基础协同（1分钟）

1. 打开浏览器 `http://localhost:5173`
2. 打开另一个标签页，访问相同地址
3. 在任意标签页输入文字
4. **看！另一个标签页实时更新了** ✨

### 2. 远程光标（1分钟）

1. 在第一个标签页，点击编辑器的某个位置
2. 在第二个标签页，看到一个彩色的光标
3. 那就是第一个用户的光标位置！
4. 鼠标悬停在光标上，显示用户名

### 3. 不同房间（1分钟）

```bash
# 标签页 1：Alice 在 room1
http://localhost:5173?room=room1&name=Alice

# 标签页 2：Bob 在 room1（和 Alice 一起）
http://localhost:5173?room=room1&name=Bob

# 标签页 3：Charlie 在 room2（独立）
http://localhost:5173?room=room2&name=Charlie
```

Alice 和 Bob 可以协同，Charlie 独立编辑

### 4. 离线编辑（2分钟）⭐

1. 打开浏览器，开始编辑
2. **F12 → Network → Offline** （模拟断网）
3. 继续编辑，输入 "离线编辑测试"
4. 状态栏显示 "✗ 未连接"，但**仍然可以编辑**！
5. **取消 Offline**（恢复网络）
6. 状态栏变成 "✓ 已连接"
7. **自动同步！** 其他标签页看到了 "离线编辑测试"

**这就是 CRDT 的魔力：离线照样编辑，上线自动同步！**

### 5. 数据持久化（30秒）

1. 编辑一些内容
2. **刷新页面**（Ctrl+R / Cmd+R）
3. **内容还在！**（保存在 IndexedDB）
4. **关闭标签页**，重新打开
5. **内容还在！**

---

## 🎨 功能清单

打勾表示已实现：

- ✅ **实时协同编辑**（多标签页/多用户）
- ✅ **远程光标和选区**（看到其他人在哪里编辑）
- ✅ **在线用户列表**（右侧显示）
- ✅ **离线编辑**（断网照样用）
- ✅ **数据持久化**（刷新不丢失）
- ✅ **房间管理**（不同房间独立编辑）
- ✅ **状态显示**（连接状态、同步状态）
- ✅ **富文本编辑**（粗体、斜体、标题、列表）
- ✅ **撤销/重做**（Ctrl+Z / Ctrl+Shift+Z）

---

## 🐛 常见问题

### Q: 服务器启动失败？

**错误**：`Error: listen EADDRINUSE: address already in use`

**原因**：端口 1234 被占用

**解决**：
```bash
# 查找占用端口的进程
lsof -i :1234

# 杀掉进程
kill -9 <PID>

# 或者修改端口
# server/server.js: const PORT = 1235
```

### Q: 前端连接不上服务器？

**检查**：
1. 服务器是否在运行？（应该看到 `🚀 Yjs WebSocket Server 启动成功！`）
2. 端口是否正确？（默认 1234）
3. 浏览器控制台有错误吗？

**解决**：
```bash
# 重启服务器
cd server
pnpm dev
```

### Q: 看不到其他用户的光标？

**检查**：
1. 是否在同一个房间？（检查 URL 的 `?room=xxx`）
2. 是否都连接成功？（状态栏显示 "✓ 已连接"）
3. 刷新页面试试

### Q: 离线编辑不工作？

**检查**：
1. 浏览器是否支持 IndexedDB？（所有现代浏览器都支持）
2. F12 → Application → IndexedDB，看到 `05-collaborative-editor-yjs` 吗？
3. 清除浏览器数据，重新加载试试

---

## 📸 效果截图说明

打开 2 个标签页后，你应该看到：

**标签页 1（Alice）**：
```
┌─────────────────────────────────────────────────┐
│ 🚀 协同编辑器                                   │
│ 基于 Yjs + Tiptap 的实时协同编辑                │
├─────────────────────────────────────────────────┤
│ 房间: default-room  连接: ✓ 已连接  同步: ✓ 已同步 │
├─────────────────────────────────────────────────┤
│ [B] [I] | H1 H2 | • 列表 1. 列表 | ↶ ↷       │
├─────────────────────────────────────────────────┤
│ Hello World!                                    │
│ ▊ ← Alice 的光标                               │
│ Bob 的光标 → ▊                                 │
├─────────────────────────────────────────────────┤
│ 在线用户 (2)                                    │
│ [A] Alice    ← 你                              │
│ [B] Bob                                        │
└─────────────────────────────────────────────────┘
```

**标签页 2（Bob）**：
```
┌─────────────────────────────────────────────────┐
│ 🚀 协同编辑器                                   │
├─────────────────────────────────────────────────┤
│ Hello World!                                    │
│ ▊ ← Bob 的光标                                 │
│ Alice 的光标 → ▊                               │
├─────────────────────────────────────────────────┤
│ 在线用户 (2)                                    │
│ [A] Alice                                       │
│ [B] Bob      ← 你                              │
└─────────────────────────────────────────────────┘
```

---

## 🎯 下一步

完成快速体验后，你可以：

1. **阅读详细文档**
   - `README.md` - 完整介绍
   - `docs/02-ot-vs-crdt-practice.md` - 深度对比

2. **修改代码**
   - 改变用户颜色
   - 添加更多工具栏按钮
   - 自定义样式

3. **添加功能**
   - 评论功能（使用 Y.Map）
   - 版本历史（使用 UndoManager）
   - P2P 协同（使用 y-webrtc）

4. **部署到生产**
   - 使用 Docker 部署服务器
   - 配置 HTTPS
   - 添加用户认证

---

## 💡 技术要点

### 这个项目展示了：

1. **Yjs** - 生产级 CRDT 库
   - 自动同步
   - 自动合并
   - 自动解决冲突

2. **Tiptap** - 现代编辑器框架
   - 基于 ProseMirror
   - React 友好
   - 插件化架构

3. **WebSocket** - 实时通信
   - 双向通信
   - 低延迟
   - 自动重连

4. **IndexedDB** - 离线存储
   - 浏览器原生
   - 大容量存储
   - 异步 API

### 对比 Phase 3 (OT)：

| | Phase 3 (OT) | Phase 6 (Yjs) |
|---|---|---|
| 代码量 | ~800 行 | ~300 行 |
| 离线编辑 | ❌ | ✅ |
| 远程光标 | ❌ | ✅ |
| 开发时间 | 6 周 | 1 周 |

**结论**：Yjs 让协同编辑变得简单！

---

## 🎉 恭喜！

你已经体验了一个**真正的、生产级的**协同编辑应用！

这不是玩具，这是和 Figma、Notion 同样技术的实现。

**你现在可以：**
- ✅ 理解 CRDT 原理（Phase 4）
- ✅ 使用 Yjs 构建应用（Phase 6）
- ✅ 对比 OT 和 CRDT
- ✅ 在简历上写 "实现过协同编辑"

**继续加油！** 🚀

